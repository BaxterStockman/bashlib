#!/usr/bin/env bats

load bashlib

test_check_that_bashlib-27s_functions_exist() { bats_test_begin "check that bashlib's functions exist" 5; 
    local -i cumulative_status=0
    for function in require bashlibinc bashlibsrc; do
        run declare -F "$function" &>/dev/null
        [[ "$status" -eq 0 ]]
    done
}

test_check_that_-24BASHLIB_contains_-24BATS-5fBASHLIB() { bats_test_begin "check that \$BASHLIB contains \$BATS_BASHLIB" 13; 
    run echo "$BASHLIB"
    [[ "${lines[0]}" == *"$BATS_BASHLIB"* ]]
    run bashlibsrc
    [[ "${lines[*]}" == *"$BATS_BASHLIB"* ]]
}

test_check_existence_of_shell_script_files() { bats_test_begin "check existence of shell script files" 20; 
    [[ -f "$pretty_path" ]]
    [[ -f "$spoon_path" ]]
}

test_check_that_relative_path_require_works() { bats_test_begin "check that relative path require works" 25; 
    skip "$(declare -f load)"
    run require "$pretty_relpath"
    require "$pretty_relpath"
    [[ "$status" -eq 0 ]]
    run pretty
    [[ "${lines[0]}" == "$pretty_msg" ]]

    run require "$spoon_relpath"
    require "$spoon_relpath"
    [[ "$status" -eq 0 ]]
    run pretty
    [[ "${lines[0]}" == "$spoon_msg" ]]
}

test_check_that_perl-2dstyle_require_works() { bats_test_begin "check that perl-style require works" 40; 
    run require i::am::pretty
    require i::am::pretty
    [[ "$status" -eq 0 ]]
    run pretty
    [[ "${lines[0]}" == "$pretty_msg" ]]

    run require no::spoon
    [[ "$status" -eq 0 ]]
    run pretty
    [[ "${lines[0]}" == "$pretty_msg" ]]
}

# vi: set ft=sh
bats_test_function test_check_that_bashlib-27s_functions_exist
bats_test_function test_check_that_-24BASHLIB_contains_-24BATS-5fBASHLIB
bats_test_function test_check_existence_of_shell_script_files
bats_test_function test_check_that_relative_path_require_works
bats_test_function test_check_that_perl-2dstyle_require_works
